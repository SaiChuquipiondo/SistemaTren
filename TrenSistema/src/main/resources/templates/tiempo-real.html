<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Viaje en Tiempo Real</title>
    <script>
      function iniciarCuentaRegresiva(segundos, idElemento, mensajeFinal) {
        const elem = document.getElementById(idElemento);
        const interval = setInterval(() => {
          let min = Math.floor(segundos / 60);
          let seg = segundos % 60;
          elem.textContent = `${min} min ${seg} seg`;
          segundos--;

          if (segundos < 0) {
            clearInterval(interval);
            elem.textContent = mensajeFinal;
          }
        }, 1000);
      }

      document.addEventListener("DOMContentLoaded", () => {
        const llegada = parseInt(
          document.getElementById("tiempoLlegadaSegundos").value
        );
        const viaje = parseInt(
          document.getElementById("tiempoViajeSegundos").value
        );

        iniciarCuentaRegresiva(
          llegada,
          "llegada",
          "Â¡El tren llegÃ³ a tu estaciÃ³n!"
        );
        setTimeout(() => {
          iniciarCuentaRegresiva(viaje, "viaje", "Â¡Llegaste a tu destino!");
        }, (llegada + 1) * 1000);
      });
    </script>
  </head>
  <body>
    <h1>SimulaciÃ³n de Viaje en Tiempo Real</h1>

    <p>
      ğŸš† EstaciÃ³n actual del tren:
      <strong th:text="${posicionTren.nombre}"></strong>
    </p>
    <p>ğŸ“ Tu estaciÃ³n: <strong th:text="${origen.nombre}"></strong></p>
    <p>ğŸ¯ Destino: <strong th:text="${destino.nombre}"></strong></p>

    <h3>â³ Tiempo estimado para que el tren llegue a ti:</h3>
    <div id="llegada"></div>

    <h3>ğŸš† Tiempo estimado desde tu estaciÃ³n hasta el destino:</h3>
    <div id="viaje"></div>

    <!-- Valores ocultos para JS -->
    <input
      type="hidden"
      id="tiempoLlegadaSegundos"
      th:value="${tiempoLlegada}"
    />
    <input type="hidden" id="tiempoViajeSegundos" th:value="${tiempoViaje}" />

    <br />
    <!--<a href="/estaciones">ğŸ”™ Volver a estaciones</a>-->
  </body>
</html>
